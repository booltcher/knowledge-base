---
outline: [2, 3]
tags: 
 - Vue 
 - 源码
publishDate: 2020/04/21
---

# 为什么组件的`data`必须是函数？

> 源码：`src/core/instance/state.js -> initState() -> initData()`


函数每次执行都会返回全新data对象实例。

在Vue实例初始化的过程中，初始化`data`时，会先对`data`的类型做判断：

- 如果`data`是一个`function`，则执行这个`function`并把执行的结果当做`data`的值
- 否则，直接使用`data`，如果是这种情况，将来我们访问实例的属性其实都是一个引用，那会造成这个属性被**共享**或者说被**污染**，这是不合理的，其中一个组件内修改了这个属性，其它的组件属性也会被修改

其次程序甚至无法通过Vue内部检测，会报错说：`data`选项应该是一个函数，它返回一个组件的声明。

**结论：为了保证实例之间的数据相互独立。**

## 那为什么根实例为什么可以使用对象？

> 源码：`src/core/instance/init.js - initMixin()`
 

在进行选项的合并时，会判断选项里的`_isComponent`这个值

会走不同的分支，如果是根实例，当时并没有组件实例，所以会跳过这个检测。

**结论：全局只会声明一个根实例。**