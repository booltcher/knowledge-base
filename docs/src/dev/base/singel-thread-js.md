---
outline: [2, 3]
tags: 
  - JavaScript
publishDate: 2020/05/26
---
# JS的单线程

## 进程

- 一个进程就是一个程序的运行实例
- 启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫进程。当一个进程关闭之后，操作系统会回收进程所占用的内存。
- 浏览器新打开一个Tab就是一个新的进程，一个进程可能包含多个线程，比如主线程(JS引擎)，渲染线程，网络线程，GPU线程等等
- 进程之间的内容相互隔离
- 一个进程挂了不会影响其他进程

## 线程

- 一个进程下的不同线程会共享数据
- 同一进程下的线程崩溃会导致整个进程崩溃

## 浏览器进程与线程

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9e020972-4d1f-4282-90d6-5edbb3d3aa79/Untitled.png)

除JS引擎以外，其他线程都不是用来执行 JS 代码的，主要用来执行其他的一些任务！

比如主线程（JS 引擎线程）中碰到AJAX请求，就把这个任务交给线程HTTP请求线程去真正的发送请求，等到请求回来了之后，再将callback里需要执行的JS回调函数，交给JS引擎线程去执行，也就是说浏览器才是真正执行发送请求这个任务的角色，而JS只是负责执行最后的回调处理。

## JS是单线程，为什么？

避免DOM渲染发生冲突

⚖️ JS的主要用途是浏览器中***操作DOM*** & ***与用户互动***

- 假如是多线程，一个线程修改了某个节点，另一个线程删除了节点，该以哪个为准？
- 这会使问题复杂化，为了避免复杂性，从一诞生，JavaScript就是单线程，否则会带来很复杂的同步问题。
- 这已经成了这门语言的核心特征，将来也不会改变。
- 而为了利用多核CPU的计算能力，虽然HTML5提出了Web Worker的标准，允许JS创建多个子线程，但是子线程完全受主线程控制，且不得操作DOM，所以本质他还是单线程。